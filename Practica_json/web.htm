<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Covid Dades 2020</title>
  <link rel="stylesheet" href="web.css">
</head>
<body>
  <h1>Covid Dades 2020</h1>
  <table>
    <thead>
      <tr>
        <th>Mes i Dades</th>
      </tr>
    </thead>
    <tbody id="datos-tabla">
    </tbody>
  </table>

  <script>
    /*En esta página web muestra los datos del Covid-19 durante el 2020 de manera que se muestren separados por meses, cada una en una casilla, y que este funcione como un boton,
      el cual, al pulsarlo se extienda la casilla y muestre los datos separados por dias correspondientes a cada mes. Se utilizan dos archivos JSON, uno en donde guarda los datos
      de cada mes, y otro de cada dia de cada mes.*/


    // Asignación de los archivos JSON
    const JSONMes = 'CovidDadesMes.json';
    const JSONDias = 'CovidDades.json';

    // Referencia al cuerpo de la tabla
    const tableBody = document.getElementById('datos-tabla');

    // Cargar archivo JSON del mes
    fetch(JSONMes)
    // Convertirlo en un objeto JavaScript
    .then(response => response.json())
    // Recorrer los datos del mes
      .then(dataMes => {
        dataMes.forEach(record => {

          // Crear una fila para cada registro del archivo JSON
          const fila = document.createElement('tr');
          // Crear una celda con todos los datos de cada mes
          const celda = document.createElement('td');
          // Crear el botón expandible
          const boton = document.createElement('button');
          // Asignarle un nombre
          boton.className = 'expandible';

          // Insertar datos dentro del botón
          boton.innerHTML = 
          // Estructura de los datos
          // El "toLocaleString()" permite agregar las comas de miles en los números 
          `
            <strong>Mes:</strong> ${record.month}<br>
            <strong>Positius:</strong> ${record.positive.toLocaleString()}<br>
            <strong>Negatius:</strong> ${record.negative.toLocaleString()}<br>
            <strong>Defuncions:</strong> ${record.death.toLocaleString()}<br>
            <strong>Hospitalitzats:</strong> ${record.hospitalized.toLocaleString()}<br>
            <strong>Total de Tests Fets:</strong> ${record.totalTestResults.toLocaleString()}
          `;

          // Crear el contenedor para añadir los datos de los días
          const datosDia = document.createElement('div');
          datosDia.className = 'datos-dia';

          // Cargar el archivo JSON de los días
          fetch(JSONDias)
          .then(response => response.json())
            .then(dataDia => {
              // Filtrar los datos de los días para que cada uno sea correspondiente al mes de su fecha (en este caso utiliza el nombre del mes "month" porque coincide en los dos archivos JSON)
              const mesDia = dataDia.filter(item => item.month === record.month);
                mesDia.forEach(dayRecord => {
                  
                  // Crear una fila para cada dia
                  const filaDia = document.createElement('tr');
                  // Crear una celda para cada dia
                  const celdaDia = document.createElement('td');

                  // Información del día
                  const infoDia = document.createElement('div');
                  infoDia.className = 'info-dia';
                  infoDia.innerHTML = `
                    <strong>Fecha:</strong> ${dayRecord.date}<br>
                    <strong>Estados:</strong> ${dayRecord.states}<br>
                    <strong>Positivos:</strong> ${dayRecord.positive.toLocaleString()}<br>
                    <strong>Negativos:</strong> ${dayRecord.negative.toLocaleString()}<br>
                    <strong>Pendientes:</strong> ${dayRecord.pending.toLocaleString()}<br>
                    <strong>Hospitalizados Hoy:</strong> ${dayRecord.hospitalizedCurrently.toLocaleString()}<br>
                    <strong>Muertes:</strong> ${dayRecord.death.toLocaleString()}<br>
                    <strong>Total de Tests Fets:</strong> ${dayRecord.totalTestResults.toLocaleString()}
                  `;
                  // Introducir los datos dentro de la celda
                  celdaDia.appendChild(infoDia);
                  // Añadir las celdas en cada fila
                  filaDia.appendChild(celdaDia);
                  //Añadir filas dentro de las celdas
                  datosDia.appendChild(filaDia);
                });
            })

          // Agregar la funcion del boton para expandir/encoger la casilla de los datos de los dias
          boton.addEventListener('click', () => {
            datosDia.style.display = datosDia.style.display === 'none' ? 'block' : 'none';
          });

          // Agregar el botón y los datos de los dias a la celda
          celda.appendChild(boton);
          celda.appendChild(datosDia);

          // Agregar la celda a la fila
          fila.appendChild(celda);

          // Añadir la fila a la tabla
          tableBody.appendChild(fila);
        });
      })
  </script>
</body>
</html>
